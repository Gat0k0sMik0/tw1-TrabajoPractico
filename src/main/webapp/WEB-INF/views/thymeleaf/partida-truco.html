<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Truco - Partida</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.0/css/bootstrap.min.css}"/>
    <!-- Estilos generales -->
    <link rel="stylesheet" th:href="@{/css/general.css}"/>
    <!-- Estilos custom -->
    <link rel="stylesheet" th:href="@{/css/partida-truco.css}"/>
</head>
<body>
<header>
    <h1 class="texto-bienvenida">PARTIDA DE TRUCO</h1>
    <div class="imagenes">
        <img th:src="@{/img/logos/javalogo.webp}" class="headerImage"/>
        <img th:src="@{/img/logos/springlogo.svg}" class="headerImage"/>
        <div class="division"></div>
        <div><img th:src="@{/img/logos/unlamsinfondo.svg}" class="headerImage"/></div>
    </div>
    <div>
        <a th:href="@{/volver-home}">Volver al menu</a>
    </div>
</header>

<main>
    <h3 th:text="${jugador2 != null && jugador1 != null
    ? 'Jugando ' + jugador1.nombre + ' VS ' + jugador2.nombre : 'Error. Falta un jugador.'}">
    </h3>
    <div id="mesa" class="gap-2">

        <!-- CARTAS JUGADOR 1 (arriba) -->
        <div id="cartas-contrincante" class="gap-1 order-0">
            <!--BOTONERA -->
            <div class="d-flex flex-wrap gap-1 col-12 justify-content-center"
                 th:if="${partidaIniciada}">
                <!-- NORMALES -->
                <div class="d-flex gap-1"
                     th:if="${mostrarRespuestasJ1 || (leTocaResponder != null && leTocaResponder.getNumero() == 1)}">
                    <a class="btn btn-primary"
                       th:href="@{/accion(mano=${mano.getId()}, accion=2, jugador=1)}">Envido
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/accion(mano=${mano.getId()}, accion=5, jugador=1)}">Truco
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/accion(mano=${mano.getId()}, accion=8, jugador=1)}">FLOR
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/accion(mano=${mano.getId()}, accion=9, jugador=1)}">MAZO
                    </a>
                </div>
                <!-- RESPUESTAS TRUCO -->
                <div id="respuestas1"
                     th:if="${mostrarRespuestasEnvidoJ1 || (leTocaResponder != null && leTocaResponder.getNumero() == 1)}">
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=1, jugador=1, accion=${accionAResponder})}">Quiero
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=0, jugador=1, accion=${accionAResponder})}">No
                        Quiero
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=6, jugador=1, accion=${accionAResponder})}">Re
                        Truco
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=7, jugador=1, accion=${accionAResponder})}">Vale
                        Cuatro
                    </a>
                </div>
                <!-- RESPUESTAS ENVIDO -->
                <div id="respuestas"
                     th:if="${mostrarRespuestasTrucoJ1 || (leTocaResponder != null && leTocaResponder.getNumero() == 1)}">
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=1, jugador=1, accion=${accionAResponder})}">Quiero
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=0, jugador=1, accion=${accionAResponder})}">No
                        Quiero
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=3, jugador=1, accion=${accionAResponder})}">Real
                        Envido
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=4, jugador=1, accion=${accionAResponder})}">Falta
                        Envido
                    </a>
                </div>
            </div>
            <!-- CARTAS  -->
            <div class="gap-2 cartasJugadorContainer col-4">
                <th:block th:each="carta : ${cartasJugador1}" th:if="${turnoJugador == 1}">
                    <a th:href="@{/accion-tirar(cartaId=${carta.id}, manoId=${mano.id}, nroJugador=1)}"
                       class="cartaTirarBtn">
                        <img th:src="@{${carta.img}}" alt="Carta" th:attr="data-id=${carta.id}" class="carta"/>
                    </a>
                </th:block>
            </div>
        </div>

        <!-- CARTAS TIRADAS -->
        <div id="cartas-en-juego" class="d-flex flex-wrap order-1">
            <div class="col-4 bor3">
                <a th:href="@{/comenzar-truco}" th:if="${ganador == null}" class="w-100">
                    <img class="mazo bor2" th:src="@{/img/cartas-truco/mazo2.png}" alt="Mazo de Cartas">
                </a>
                <a th:if="${ganador != null}" class="w-100">
                    <img class="mazo bor1" th:src="@{/img/cartas-truco/mazo2.png}" alt="Mazo de Cartas">
                </a>
            </div>
            <div id="texto-repartir" th:if="${partidaIniciada == false}" class="col-8">
                <img th:src="@{/img/cartas-truco/repartir-cartas-v2.png}" alt="Texto repartir">
            </div>
            <div class="col-4 d-flex flex-column flex-wrap gap-1" th:if="${partidaIniciada == true}">
                <div class="d-flex justify-content-center gap-2" th:if="${cartasTiradasJ1 != null}">
                    <img th:each="carta : ${cartasTiradasJ1}" th:src="@{${carta.img}}" alt="Carta" class="cartaTirada"/>
                </div>
                <div class="d-flex justify-content-center gap-2" th:if="${cartasTiradasJ2 != null}">
                    <img th:each="carta : ${cartasTiradasJ2}" th:src="@{${carta.img}}" alt="Carta" class="cartaTirada"/>
                </div>
            </div>
            <div class="col-4 d-flex flex-column justify-content-center align-items-center">
                <div th:if="${ganador != null}">
                    <p>Ganó <strong th:text="${ganador.getNombre()}"></strong>!</p>
                    <a class="btn btn-danger"
                       th:href="@{/salir}">Salir</a>
                </div>
                <div th:if="${ganador == null}">
                    <p th:if="${puntosJ1 != null}"
                       th:text="${jugador1.nombre + ' ' + puntosJ1}"></p>
                    <p th:if="${puntosJ2 != null}"
                       th:text="${jugador2.nombre + ' ' + puntosJ2}"></p>
                    <p th:if="${turnoJugador != null}"
                       th:text="'Turno de jugador ' + ${turnoJugador}"></p>
                    <p th:if="${partida != null}"
                       th:text="'Partida a  ' + ${partida.getPuntosParaGanar() +  ' puntos'}"></p>
                    <a th:if="${seTermino}"
                       class="btn btn-danger"
                       th:text="'Jugar otra mano'"
                       th:href="@{/cambiar-mano}"></a>
                </div>

            </div>
        </div>

        <!-- CARTAS JUGADOR RIVAL -->
        <div id="cartas_jugador" class="order-2 gap-1">
            <!--BOTONERA -->
            <div class="d-flex flex-wrap gap-1 col-12 justify-content-center"
                 th:if="${partidaIniciada}">
                <!-- NORMALES -->
                <div class="d-flex gap-1"
                     th:if="${mostrarRespuestasJ2 || (leTocaResponder != null && leTocaResponder.getNumero() == 2)}">
                    <a class="btn btn-primary"
                       th:href="@{/accion(mano=${mano.getId()}, accion=2, jugador=2)}">Envido
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/accion(mano=${mano.getId()}, accion=5, jugador=2)}">Truco
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/accion(mano=${mano.getId()}, accion=8, jugador=2)}">Flor
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/accion(mano=${mano.getId()}, accion=9, jugador=2)}">Mazo
                    </a>
                </div>
                <!-- RESPUESTA ENVIDO -->
                <div th:if="${mostrarRespuestasEnvidoJ2 || (leTocaResponder != null && leTocaResponder.getNumero() == 2)}">
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=1, jugador=2, accion=${accionAResponder})}">Quiero
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=0, jugador=2, accion=${accionAResponder})}">No
                        Quiero
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=3, jugador=2, accion=${accionAResponder})}">Real
                        Envido
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=4, jugador=2, accion=${accionAResponder})}">Falta
                        Envido
                    </a>
                    <!-- FIN NUEVA LÓGICA -->
                </div>
                <!-- RESPUESTAS TRUCO -->
                <div id="respuesta1"
                     th:if="${mostrarRespuestasEnvidoJ2 || (leTocaResponder != null && leTocaResponder.getNumero() == 2)}">
                    <!-- NUEVA LÓGICA -->
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=1, jugador=2, accion=${accionAResponder})}">Quiero
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=0, jugador=2, accion=${accionAResponder})}">No
                        Quiero
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=6, jugador=2, accion=${accionAResponder})}">Re
                        Truco
                    </a>
                    <a class="btn btn-primary"
                       th:href="@{/respuesta(mano=${mano.getId()}, respuesta=7, jugador=2, accion=${accionAResponder})}">Vale
                        Cuatro
                    </a>
                </div>
            </div>
            <!-- CARTAS -->
            <div class="gap-2 cartasJugadorContainer col-4">
                <th:block th:each="carta : ${cartasJugador2}" th:if="${turnoJugador == 2}">
                    <a th:href="@{/accion-tirar(cartaId=${carta.id}, manoId=${mano.id}, nroJugador=2)}"
                       class="cartaTirarBtn">
                        <img th:src="@{${carta.img}}" alt="Carta" th:attr="data-id=${carta.id}" class="carta"/>
                    </a>
                </th:block>

            </div>
        </div>
    </div>
    <p th:if="${jugador1 != null}" th:text="${jugador1}"></p>
    <p th:if="${jugador2 != null}" th:text="${jugador2}"></p>
    <p th:if="${partida != null}" th:text="${partida}"></p>
</main>
<!-- Footer -->
<footer>
    <div class="footer-container">
        <p>&copy; 2024 UNLAM. Todos los derechos reservados.</p>
        <div class="footer-alumnos">
            <p>Lucas Gavagnin | </p>
            <p>Gonzalo Ramos | </p>
            <p>Martin Zaccardo | </p>
            <p>Franco Vargas | </p>
            <p>Victoria Croce </p>
        </div>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const cartas = document.querySelectorAll('.carta');
        const cartaSeleccionadaInput = document.getElementById('cartaSeleccionada');

        cartas.forEach(carta => {
            carta.addEventListener('click', () => {
                /* Al hacer click en una carta, se borra el estilo en las demas
                * y se aplica solo a la que seleccioné */
                cartas.forEach(c => c.classList.remove('carta-seleccionada'));
                carta.classList.add('carta-seleccionada');

                const cartaId = carta.getAttribute('data-id');
                // Asignar el ID al input oculto
                cartaSeleccionadaInput.value = cartaId;
            })
        })
    })
</script>
</body>
</html>
